<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>MP4v2 2.0.0 PROJECT_name: example/itmf/generic.c</title>
    <link href="project.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="sitebanner">
    <div id="home">
        <a href="http://code.google.com/p/mp4v2"></a>
    </div>
    <div id="title">
        PROJECT_name: example/itmf/generic.c
    </div>
    <div id="menu">
        <ul>
            <li><a href="http://code.google.com/p/mp4v2">MP4v2 Home</a></li>
            <li><a href="../index.html">Documentation</a></li>
            <li class="active">API Reference</li>
        </ul>
    </div>
</div>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>example/itmf/generic.c</h1><div class="fragment"><pre class="fragment"><span class="comment">/* This is an example of iTMF Generic API.</span>
<span class="comment"> * WARNING: this program will change/destroy certain tags in an mp4 file.</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;mp4v2/mp4v2.h&gt;</span>

<span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )
{
    <span class="keywordflow">if</span>( argc != 2 ) {
        printf( <span class="stringliteral">&quot;usage: %s file.mp4\n&quot;</span>, argv[0] );
        <span class="keywordflow">return</span> 1;
    }

    <span class="comment">/* open file for modification */</span>
    MP4FileHandle file = <a name="a0"></a><a class="code" href="group__mp4__file.html#ga3fc8331224485351cfbaec4d0194b623" title="Modify an existing mp4 file.">MP4Modify</a>( argv[1], MP4_DETAILS_ERROR, 0 );
    <span class="keywordflow">if</span>( file == <a name="a1"></a><a class="code" href="group__mp4__general.html#gafa387d447016a2c4fb1bb7e70b6e3b32" title="Constant: invalid MP4FileHandle.">MP4_INVALID_FILE_HANDLE</a> ) {
        printf( <span class="stringliteral">&quot;MP4Modify failed\n&quot;</span> );
        <span class="keywordflow">return</span> 1;
    }

    <span class="comment">/* show existing iTMF items */</span>
    <a name="_a2"></a><a class="code" href="struct_m_p4_itmf_item_list__s.html" title="List of items.">MP4ItmfItemList</a>* list = <a name="a3"></a><a class="code" href="group__mp4__itmf__generic.html#ga9cb2fdd99184179245b406cadc1e9e1b" title="Get list of all items from file.">MP4ItmfGetItems</a>( file );
    printf( <span class="stringliteral">&quot;list=%p\n&quot;</span>, list );
    <span class="keywordflow">if</span>( list ) {
        printf( <span class="stringliteral">&quot;list size=%u\n&quot;</span>, list-&gt;<a name="a4"></a><a class="code" href="struct_m_p4_itmf_item_list__s.html#af94f4b02083d8d695b3bf816df2378a8" title="number of elements.">size</a> );
        uint32_t i;
        <span class="keywordflow">for</span>( i = 0; i &lt; list-&gt;<a class="code" href="struct_m_p4_itmf_item_list__s.html#af94f4b02083d8d695b3bf816df2378a8" title="number of elements.">size</a>; i++ ) {
            <a name="_a5"></a><a class="code" href="struct_m_p4_itmf_item__s.html" title="Item structure.">MP4ItmfItem</a>* item = &amp;list-&gt;<a name="a6"></a><a class="code" href="struct_m_p4_itmf_item_list__s.html#a014e09295e20f1326a02470b2ea19bd5" title="flat array.">elements</a>[i];
            printf( <span class="stringliteral">&quot;item[%u] type=%s\n&quot;</span>, i, item-&gt;<a name="a7"></a><a class="code" href="struct_m_p4_itmf_item__s.html#a2fc3716df0a9c6629809a02b59e00a2c" title="four-char code identifing atom type.">code</a> );

            <span class="keywordflow">if</span>( item-&gt;<a name="a8"></a><a class="code" href="struct_m_p4_itmf_item__s.html#a9e14edc34ad73af1fa351a82f55ceb45" title="may be NULL.">mean</a> )
                printf( <span class="stringliteral">&quot;    mean=%s\n&quot;</span>, item-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#a9e14edc34ad73af1fa351a82f55ceb45" title="may be NULL.">mean</a> );
            <span class="keywordflow">if</span>( item-&gt;<a name="a9"></a><a class="code" href="struct_m_p4_itmf_item__s.html#a29344f545bbd8c7f691b84a6d38c51dd" title="may be NULL.">name</a> )
                printf( <span class="stringliteral">&quot;    name=%s\n&quot;</span>, item-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#a29344f545bbd8c7f691b84a6d38c51dd" title="may be NULL.">name</a> );

            <span class="keywordtype">int</span> j;
            <span class="keywordflow">for</span>( j = 0; j &lt; item-&gt;<a name="a10"></a><a class="code" href="struct_m_p4_itmf_item__s.html#acce780149ed16453fd453b55bc684184" title="list of data.">dataList</a>.<a name="a11"></a><a class="code" href="struct_m_p4_itmf_data_list__s.html#ab03b4b2f01ffd84010b969ed7e2cc03a" title="number of elements.">size</a>; j++ ) {
                <a name="_a12"></a><a class="code" href="struct_m_p4_itmf_data__s.html" title="Data structure.">MP4ItmfData</a>* data = &amp;item-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#acce780149ed16453fd453b55bc684184" title="list of data.">dataList</a>.<a name="a13"></a><a class="code" href="struct_m_p4_itmf_data_list__s.html#a8c2a7efbf8449282beb54ee7eed3d5aa" title="flat array.">elements</a>[j];
                printf( <span class="stringliteral">&quot;    data[%u] typeCode=%u valueSize=%u\n&quot;</span>, j, data-&gt;<a name="a14"></a><a class="code" href="struct_m_p4_itmf_data__s.html#a169ada536e0642ac8c115b7a20187c5e" title="iTMF basic type.">typeCode</a>, data-&gt;<a name="a15"></a><a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> );
            }
        }

        <span class="comment">/* caller responsiblity to free */</span>
        <a name="a16"></a><a class="code" href="group__mp4__itmf__generic.html#gac54f69419ab19490c8f2a97c3d172c12" title="Free an item list (deep free).">MP4ItmfItemListFree</a>( list );
    }

    <span class="comment">/* add bogus item to file */</span>
    {
        <span class="comment">/* allocate item with 1 data element */</span>
        <a class="code" href="struct_m_p4_itmf_item__s.html" title="Item structure.">MP4ItmfItem</a>* bogus = <a name="a17"></a><a class="code" href="group__mp4__itmf__generic.html#ga93bb2f5a0bc2e09c1bb8a430139daff4" title="Allocate an item on the heap.">MP4ItmfItemAlloc</a>( <span class="stringliteral">&quot;bogu&quot;</span>, 1 );

        <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> hello = <span class="stringliteral">&quot;hello one&quot;</span>;

        <a class="code" href="struct_m_p4_itmf_data__s.html" title="Data structure.">MP4ItmfData</a>* data = &amp;bogus-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#acce780149ed16453fd453b55bc684184" title="list of data.">dataList</a>.<a class="code" href="struct_m_p4_itmf_data_list__s.html#a8c2a7efbf8449282beb54ee7eed3d5aa" title="flat array.">elements</a>[0];
        data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a169ada536e0642ac8c115b7a20187c5e" title="iTMF basic type.">typeCode</a> = <a name="a18"></a><a class="code" href="group__mp4__itmf__generic.html#gga9da6b712636b32fdb48ae78167e6f505a60a6ab2be2ce0936cd0ad79137620d7c" title="without any count or null terminator">MP4_ITMF_BT_UTF8</a>;
        data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> = strlen( hello );
        data-&gt;<a name="a19"></a><a class="code" href="struct_m_p4_itmf_data__s.html#a239502caddbe22b6c923d51506b00c05" title="may be NULL.">value</a> = (uint8_t*)malloc( data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> );
        memcpy( data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a239502caddbe22b6c923d51506b00c05" title="may be NULL.">value</a>, hello, data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> );

        <span class="comment">/* add to mp4 file */</span>
        <a name="a20"></a><a class="code" href="group__mp4__itmf__generic.html#ga492e7fc053bdb4f11325b273d20be04a" title="Add an item to file.">MP4ItmfAddItem</a>( file, bogus );

        <span class="comment">/* caller responsibility to free */</span>
        <a name="a21"></a><a class="code" href="group__mp4__itmf__generic.html#ga110dbe8d373b13a98f6bb3de705dba6e" title="Free an item (deep free).">MP4ItmfItemFree</a>( bogus );
    }

    <span class="comment">/* add bogus item with meaning and name to file */</span>
    {
        <span class="comment">/* allocate item with 1 data element */</span>
        <a class="code" href="struct_m_p4_itmf_item__s.html" title="Item structure.">MP4ItmfItem</a>* bogus = <a class="code" href="group__mp4__itmf__generic.html#ga93bb2f5a0bc2e09c1bb8a430139daff4" title="Allocate an item on the heap.">MP4ItmfItemAlloc</a>( <span class="stringliteral">&quot;----&quot;</span>, 1 );
        bogus-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#a9e14edc34ad73af1fa351a82f55ceb45" title="may be NULL.">mean</a> = strdup( <span class="stringliteral">&quot;com.garden.Tomato&quot;</span> );
        bogus-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#a29344f545bbd8c7f691b84a6d38c51dd" title="may be NULL.">name</a> = strdup( <span class="stringliteral">&quot;weight&quot;</span> );

        <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> hello = <span class="stringliteral">&quot;hello two&quot;</span>;

        <a class="code" href="struct_m_p4_itmf_data__s.html" title="Data structure.">MP4ItmfData</a>* data = &amp;bogus-&gt;<a class="code" href="struct_m_p4_itmf_item__s.html#acce780149ed16453fd453b55bc684184" title="list of data.">dataList</a>.<a class="code" href="struct_m_p4_itmf_data_list__s.html#a8c2a7efbf8449282beb54ee7eed3d5aa" title="flat array.">elements</a>[0];
        data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a169ada536e0642ac8c115b7a20187c5e" title="iTMF basic type.">typeCode</a> = <a class="code" href="group__mp4__itmf__generic.html#gga9da6b712636b32fdb48ae78167e6f505a60a6ab2be2ce0936cd0ad79137620d7c" title="without any count or null terminator">MP4_ITMF_BT_UTF8</a>;
        data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> = strlen( hello );
        data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a239502caddbe22b6c923d51506b00c05" title="may be NULL.">value</a> = (uint8_t*)malloc( data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> );
        memcpy( data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a239502caddbe22b6c923d51506b00c05" title="may be NULL.">value</a>, hello, data-&gt;<a class="code" href="struct_m_p4_itmf_data__s.html#a4e85ee33f2f1b3836c61f20bd8284ccc" title="value size in bytes.">valueSize</a> );

        <span class="comment">/* add to mp4 file */</span>
        <a class="code" href="group__mp4__itmf__generic.html#ga492e7fc053bdb4f11325b273d20be04a" title="Add an item to file.">MP4ItmfAddItem</a>( file, bogus );

        <span class="comment">/* caller responsibility to free */</span>
        <a class="code" href="group__mp4__itmf__generic.html#ga110dbe8d373b13a98f6bb3de705dba6e" title="Free an item (deep free).">MP4ItmfItemFree</a>( bogus );
    }

    <span class="comment">/* free memory associated with structure and close */</span>
    <a name="a22"></a><a class="code" href="group__mp4__file.html#ga484d26d892b561ab0a95f9ce79036dfa" title="Close an mp4 file.">MP4Close</a>( file );

    <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<div class="footer">
    <div>
        generated on Sun May 20 21:18:55 2012 for <b>MP4v2 (2.0.0)</b>
        by&nbsp;<a href="http://www.doxygen.org">Doxygen</a> 1.6.3
    </div>
</div>
</body>
</html>
